<!-- password-settings.component.html -->
<div class="password-management">
  <!-- Success/Error Messages -->
  <div *ngIf="successMessage" class="alert alert-success alert-compact mb-3">
    <i class="bi bi-check-circle me-2"></i>{{ successMessage }}
    <button type="button" class="btn-close btn-close-sm" (click)="clearMessages()"></button>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger alert-compact mb-3">
    <i class="bi bi-exclamation-circle me-2"></i>{{ errorMessage }}
    <button type="button" class="btn-close btn-close-sm" (click)="clearMessages()"></button>
  </div>

  <!-- Password Change Form -->
  <div class="password-form card">
    <div class="card-header">
      <h5 class="card-title">
        <i class="bi bi-shield-lock me-2"></i>
        Change Password
      </h5>
      <small class="text-muted">Keep your account secure with a strong password</small>
    </div>
    
    <div class="card-body">
      <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
        
        <!-- Current Password Row -->
        <div class="form-row">
          <div class="form-col">
            <label class="form-label-compact">Current Password *</label>
            <div class="input-group">
              <input [type]="showCurrentPassword ? 'text' : 'password'" 
                     formControlName="currentPassword" 
                     class="form-control form-control-compact"
                     [class.is-invalid]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched"
                     [disabled]="isLoading"
                     placeholder="Enter current password">
              <button type="button" class="btn btn-outline-secondary btn-compact" 
                      (click)="toggleCurrentPassword()" 
                      [disabled]="isLoading">
                <i [class]="showCurrentPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
              </button>
            </div>
            <div class="error-space">
              <div *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched; else spacer1" 
                   class="error-text-compact">Current password is required</div>
              <ng-template #spacer1><div class="error-spacer"></div></ng-template>
            </div>
          </div>
        </div>

        <!-- New Password Row -->
        <div class="form-row">
          <div class="form-col">
            <label class="form-label-compact">New Password *</label>
            <div class="input-group">
              <input [type]="showNewPassword ? 'text' : 'password'" 
                     formControlName="newPassword" 
                     class="form-control form-control-compact"
                     [class.is-invalid]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched"
                     [disabled]="isLoading"
                     placeholder="Create a strong password"
                     (input)="onPasswordStrengthCheck()">
              <button type="button" class="btn btn-outline-secondary btn-compact" 
                      (click)="toggleNewPassword()" 
                      [disabled]="isLoading">
                <i [class]="showNewPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
              </button>
            </div>
            
            <!-- Password Strength Indicator -->
            <div class="password-strength-compact" *ngIf="passwordForm.get('newPassword')?.value">
              <div class="strength-bar">
                <div class="strength-fill" 
                     [ngClass]="getPasswordStrengthClass()" 
                     [style.width.%]="getPasswordStrengthPercent()"></div>
              </div>
              <span class="strength-text" [ngClass]="getPasswordStrengthClass()">
                {{ getPasswordStrengthText() }}
              </span>
            </div>

            <div class="error-space">
              <div *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched; else spacer2" 
                   class="error-text-compact">
                <span *ngIf="passwordForm.get('newPassword')?.errors?.['required']">New password is required</span>
                <span *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">Password must be at least 6 characters</span>
                <span *ngIf="passwordForm.get('newPassword')?.errors?.['pattern']">Password must contain letters and numbers</span>
              </div>
              <ng-template #spacer2><div class="error-spacer"></div></ng-template>
            </div>
          </div>
        </div>

        <!-- Confirm Password Row -->
        <div class="form-row">
          <div class="form-col">
            <label class="form-label-compact">Confirm New Password *</label>
            <div class="input-group">
              <input [type]="showConfirmPassword ? 'text' : 'password'" 
                     formControlName="confirmPassword" 
                     class="form-control form-control-compact"
                     [class.is-invalid]="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched"
                     [disabled]="isLoading"
                     placeholder="Confirm new password">
              <button type="button" class="btn btn-outline-secondary btn-compact" 
                      (click)="toggleConfirmPassword()" 
                      [disabled]="isLoading">
                <i [class]="showConfirmPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
              </button>
            </div>
            <div class="error-space">
              <div *ngIf="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched; else spacer3" 
                   class="error-text-compact">
                <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">Please confirm your password</span>
                <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['passwordMismatch']">Passwords don't match</span>
              </div>
              <ng-template #spacer3><div class="error-spacer"></div></ng-template>
            </div>
          </div>
        </div>

        <!-- Password Requirements -->
        <div class="password-requirements-compact" *ngIf="passwordForm.get('newPassword')?.value">
          <label class="form-label-compact">Password Requirements</label>
          <div class="requirements-grid">
            <div class="requirement-item-compact" [ngClass]="getRequirementClass('length')">
              <i class="bi bi-check-circle-fill me-1"></i>
              <span>At least 6 characters</span>
            </div>
            <div class="requirement-item-compact" [ngClass]="getRequirementClass('letters')">
              <i class="bi bi-check-circle-fill me-1"></i>
              <span>Contains letters</span>
            </div>
            <div class="requirement-item-compact" [ngClass]="getRequirementClass('numbers')">
              <i class="bi bi-check-circle-fill me-1"></i>
              <span>Contains numbers</span>
            </div>
            <div class="requirement-item-compact" [ngClass]="getRequirementClass('special')">
              <i class="bi bi-check-circle-fill me-1"></i>
              <span>Special chars (recommended)</span>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="submit" class="btn btn-primary btn-compact" [disabled]="passwordForm.invalid || isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
            <span *ngIf="!isLoading"><i class="bi bi-shield-check me-1"></i></span>
            {{ isLoading ? 'Updating Password...' : 'Change Password' }}
          </button>
          <button type="button" class="btn btn-secondary btn-compact ms-2" (click)="resetForm()" [disabled]="isLoading">
            <i class="bi bi-x-circle me-1"></i>Reset Form
          </button>
        </div>
      </form>

      <!-- Security Notice -->
      <div class="security-notice-compact">
        <div class="notice-content">
          <i class="bi bi-info-circle me-2 text-info"></i>
          <small class="text-muted">
            <strong>Security Note:</strong> After changing your password, you'll be logged out from all devices.
          </small>
        </div>
      </div>
    </div>
  </div>
</div>
